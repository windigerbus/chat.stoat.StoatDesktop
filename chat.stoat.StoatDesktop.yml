app-id: chat.stoat.StoatDesktop
runtime: org.freedesktop.Platform
runtime-version: '25.08'
sdk: org.freedesktop.Sdk
base: org.electronjs.Electron2.BaseApp
base-version: '25.08'
sdk-extensions:
  - org.freedesktop.Sdk.Extension.node24
command: stoat-desktop
separate-locales: false
finish-args:
- --share=ipc
- --socket=x11
- --socket=pulseaudio
- --device=all
- --share=network
- --filesystem=xdg-documents:ro
- --filesystem=xdg-pictures:ro
- --filesystem=xdg-videos:ro

- --talk-name=org.kde.StatusNotifierWatcher

- --env=ELECTRON_OZONE_PLATFORM_HINT=auto
- --env=XCURSOR_PATH=/run/host/user-share/icons:/run/host/share/icons
build-options:
  append-path: /usr/lib/sdk/node24/bin
  env:
    NPM_CONFIG_LOGLEVEL: info
modules:
  - name: stoat-desktop
    buildsystem: simple
    build-commands:
      - cp -a stoat-desktop /app/
      - install -Dm775 stoat-desktop.sh /app/bin/stoat-desktop
      - install -D icon.png /app/share/icons/hicolor/256x256/apps/chat.stoat.StoatDesktop.png
      - install -D chat.stoat.StoatDesktop.desktop -t /app/share/applications/
    sources:
      - type: archive
        only-arches: [x86_64]
        url: https://github.com/stoatchat/for-desktop/releases/download/v1.1.12/Stoat-linux-x64-1.1.12.zip
        sha256: eabbdb9a84867669725d84bb1b7884ea752e2f82076c34ca5a249e6c0557ab6f
        dest: stoat-desktop
      - type: archive
        only-arches: [aarch64]
        url: https://github.com/stoatchat/for-desktop/releases/download/v1.1.11/Stoat-linux-arm64-1.1.11.zip
        sha256: d5fd93f977abd813e6855756d814ad29b10f6255cd813f34565bf31aa83343c4
        dest: stoat-desktop
      - type: script
        dest-filename: stoat-desktop.sh
        commands:
        - zypak-wrapper /app/stoat-desktop/stoat-desktop "$@"
      - type: file
        url: https://raw.githubusercontent.com/stoatchat/assets/master/desktop/icon%402x.png
        sha256: 6b369bcd3c32ac1e19130205b3f35b4490899a12b718e99eded234015535837f
        dest-filename: icon.png
      - type: file
        path: chat.stoat.StoatDesktop.desktop